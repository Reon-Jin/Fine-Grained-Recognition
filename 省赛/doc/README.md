# AI 图像检测项目文档

## 项目概述

该项目旨在构建一个基于深度学习的图像检测模型，使用 EfficientNet 作为基础架构，进行二分类任务。项目包括数据处理、模型训练、预测和结果保存等功能。

## 项目结构

该项目包含以下主要文件:

1. `src/model.py`: 定义了 AI 模型的结构。
1. `src/requirements.txt`: 列出了项目所需的依赖。
1. `src/main.py`: 包含了模型预测和结果保存的主要逻辑。
1. `src/train.py`: 实现了模型的训练和验证过程。
1. `src/config.py`: 包含了数据转换和数据集类的定义。

## 模型结构

项目选用 EfficientNet-B0 作为基础网络，主要基于以下考虑：

- 高效的模型缩放方法：EfficientNet 通过复合缩放同时调整网络的宽度、深度和分辨率
- 优秀的参数效率：在相似参数量下，具有更好的性能表现
- 适合迁移学习：预训练模型在 ImageNet 上有良好的特征提取能力

关键设计点：

- 单一输出节点：直接输出 0-1 之间的概率值
- Sigmoid 激活：将输出映射到概率空间
- 预训练权重：利用 ImageNet 预训练模型进行迁移学习

## 数据处理

处理步骤详解：

1. 尺寸统一：

   - 将所有图片缩放至 128×128
   - 保持宽高比例一致，避免图像失真

1. 张量转换：

   - 转换为 PyTorch 张量格式
   - 像素值归一化到 [0,1] 区间

1. 标准化：

   - 使用 ImageNet 数据集的均值和标准差
   - 有助于模型收敛和泛化

数据集特点：

- 动态加载：按需读取图片，节省内存
- RGB 转换：统一转换为 3 通道
- ID 追踪：保留图片 ID 用于结果输出

## 训练算法详解

1. 损失函数设计

   - 使用二元交叉熵损失（BCELoss）
   - 适用于二分类问题

1. 优化策略

   - AdamW：
     - 结合了 Adam 的自适应学习率
     - 添加权重衰减进行正则化
     - 初始学习率设为 0.001
   - 余弦退火：
     - 学习率周期性变化
     - 有助于跳出局部最优
     - 最终阶段可以达到更小的学习率

1. 训练过程

- 批次处理：
  - 训练批量大小为 128
  - 验证批量大小为 256
- 梯度更新：
  - 每批次清零梯度
  - 计算损失后反向传播
  - 优化器更新参数
- 验证评估：
  - 使用准确率作为评估指标
  - 阈值设置为 0.5

## 推理预测

1. 加载预训练模型: 从保存的权重文件中加载模型。

1. 对测试数据进行预测:

   - 使用 `TestDataset` 加载测试数据。
   - 对每个批次的数据进行预测。
   - 将预测结果转换为二进制标签（0 或 1）。

1. 将预测结果保存为 CSV 文件:

   - 创建包含图像 ID 和预测标签的 DataFrame。
   - 将结果保存为 CSV 文件，不包含索引和列名。

## 性能优化技巧

1. 内存优化：

   - 使用 `torch.no_grad()` 节省显存
   - 批次处理避免内存溢出

1. 速度优化：

   - 多进程数据加载
   - GPU 加速计算
   - 适当的批次大小

1. 精度优化：

   - 使用预训练模型
   - 学习率调度策略
   - 合理的数据预处理

## 依赖

- torch
- torchvision
- tqdm
- pandas
- efficientnet_pytorch
